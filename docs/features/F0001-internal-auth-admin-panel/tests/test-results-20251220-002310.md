# Test Results - Internal Auth + Admin Panel

Execução de testes de API para a feature F0001-internal-auth-admin-panel em ambiente isolado.

**Executado:** 2025-12-20 00:23:10
**Resultado:** 2/8 arquivos passaram (25.0%)
**Status:** FAILED

---

## Spec (Token-Efficient)

{"execution":{"timestamp":"2025-12-20T03:23:10Z","duration_ms":444,"feature":"F0001-internal-auth-admin-panel"}}
{"summary":{"total_files":8,"total_requests":11,"passed_files":2,"failed_files":6,"pass_rate":"25.0%"}}
{"infrastructure":{"postgres":"ready","redis":"ready","migrations":"5 applied","seed":"admin@fnd.dev created","backend":"started port 3099"}}
{"failed_files":["00-setup.hurl","01-auth-signup-signin.hurl","02-auth-sessions.hurl","03-auth-password-reset.hurl","04-auth-email-verification.hurl","05-manager-users.hurl","06-manager-impersonate.hurl","07-manager-metrics.hurl"]}
{"passed_files":["unknown","unknown"]}

---

## Detalhes das Falhas

### 00-setup.hurl - Health Check e Super Admin Login

**Linha:** 35
**Esperado:** jsonpath "$.user.email" == "admin@fnd.dev"
**Recebido:** string <admin@fnd.dev>

**Análise:** O teste espera que o campo `$.user.email` seja exatamente "admin@fnd.dev". O valor retornado parece correto, mas o teste falhou. Possível problema com o tipo de comparação ou estrutura da resposta.

**Contexto para /fix:**
- Endpoint: POST /api/v1/auth/signin
- Handler: AuthController.signIn
- Arquivo provável: [apps/backend/src/api/modules/auth/auth.controller.ts](apps/backend/src/api/modules/auth/auth.controller.ts)
- DTO de resposta: [apps/backend/src/api/modules/auth/dtos/AuthResponseDto.ts](apps/backend/src/api/modules/auth/dtos/AuthResponseDto.ts)

---

### 01-auth-signup-signin.hurl - Signup com Email Duplicado

**Linha:** 50
**Esperado:** jsonpath "$.message" contains "already exists"
**Recebido:** string <Email already registered>

**Análise:** O teste espera que a mensagem de erro contenha "already exists", mas a API retorna "Email already registered". Discrepância entre mensagem esperada vs implementada.

**Contexto para /fix:**
- Endpoint: POST /api/v1/auth/signup
- Handler: SignUpCommand / SignUpCommandHandler
- Arquivo provável: [apps/backend/src/api/modules/auth/commands/SignUpCommand.ts](apps/backend/src/api/modules/auth/commands/SignUpCommand.ts)
- Validação no: UserRepository.create ou SignUpCommandHandler

---

### 02-auth-sessions.hurl - Gerenciamento de Sessões

**Status:** Falhou (sem detalhes no output)

**Contexto para /fix:**
- Endpoints: GET /api/v1/auth/sessions, DELETE /api/v1/auth/sessions/:id
- Handler: AuthController
- Arquivo provável: [apps/backend/src/api/modules/auth/auth.controller.ts](apps/backend/src/api/modules/auth/auth.controller.ts)

---

### 03-auth-password-reset.hurl - Reset de Senha

**Status:** Falhou (sem detalhes no output)

**Contexto para /fix:**
- Endpoints: POST /api/v1/auth/forgot-password, POST /api/v1/auth/reset-password
- Handlers: ForgotPasswordCommand, ResetPasswordCommand
- Arquivos prováveis:
  - [apps/backend/src/api/modules/auth/commands/ForgotPasswordCommand.ts](apps/backend/src/api/modules/auth/commands/ForgotPasswordCommand.ts)
  - [apps/backend/src/api/modules/auth/commands/ResetPasswordCommand.ts](apps/backend/src/api/modules/auth/commands/ResetPasswordCommand.ts)

---

### 04-auth-email-verification.hurl - Verificação de Email

**Status:** Falhou (sem detalhes no output)

**Contexto para /fix:**
- Endpoints: POST /api/v1/auth/verify-email
- Handler: VerifyEmailCommand
- Arquivo provável: [apps/backend/src/api/modules/auth/commands/VerifyEmailCommand.ts](apps/backend/src/api/modules/auth/commands/VerifyEmailCommand.ts)

---

### 05-manager-users.hurl - Listagem e Gerenciamento de Usuários

**Status:** Falhou (sem detalhes no output)

**Contexto para /fix:**
- Endpoints: GET /api/v1/manager/users, GET /api/v1/manager/users/:id, PUT /api/v1/manager/users/:id/status
- Handler: ManagerController
- Arquivo provável: [apps/backend/src/api/modules/manager/manager.controller.ts](apps/backend/src/api/modules/manager/manager.controller.ts)

---

### 06-manager-impersonate.hurl - Impersonação de Usuários

**Status:** Falhou (sem detalhes no output)

**Contexto para /fix:**
- Endpoints: POST /api/v1/manager/impersonate, POST /api/v1/manager/impersonate/end
- Handlers: ImpersonateCommand, EndImpersonateCommand
- Arquivos prováveis:
  - [apps/backend/src/api/modules/manager/commands/ImpersonateCommand.ts](apps/backend/src/api/modules/manager/commands/ImpersonateCommand.ts)
  - [apps/backend/src/api/modules/manager/commands/EndImpersonateCommand.ts](apps/backend/src/api/modules/manager/commands/EndImpersonateCommand.ts)

---

### 07-manager-metrics.hurl - Métricas do Sistema

**Status:** Falhou (sem detalhes no output)

**Contexto para /fix:**
- Endpoint: GET /api/v1/manager/metrics
- Handler: ManagerController.getMetrics
- Arquivo provável: [apps/backend/src/api/modules/manager/manager.controller.ts](apps/backend/src/api/modules/manager/manager.controller.ts)

---

## Ambiente de Testes

{"containers":{"postgres":{"image":"postgres:15","port":5433,"database":"fnd_easyflow_test","user":"fnd_test"},"redis":{"image":"redis:7","port":6380}}}
{"backend":{"port":3099,"mode":"api","migrations":"5 applied","seed":"super_admin created"}}

---

## Próximos Passos

Para corrigir as falhas:

1. Execute `/fix` e mencione este relatório
2. Ou corrija manualmente baseado nos contextos acima
3. Re-execute os testes com `/test-api`

**Arquivos de teste:** [docs/features/F0001-internal-auth-admin-panel/tests/api/](docs/features/F0001-internal-auth-admin-panel/tests/api/)

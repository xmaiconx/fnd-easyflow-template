# Test Results - Internal Auth + Admin Panel

Execu√ß√£o de testes de API para a feature F0001-internal-auth-admin-panel.

**Executado:** 2025-12-20 00:44:27
**Resultado:** 2/8 arquivos passaram (6/8 falharam)
**Status:** FAILED
**Dura√ß√£o:** 339ms

---

## Spec (Token-Efficient)

{"execution":{"timestamp":"2025-12-20T03:44:27Z","duration_ms":339,"feature":"F0001-internal-auth-admin-panel","total_requests":12,"req_per_sec":35.4}}
{"summary":{"total_files":8,"passed_files":2,"failed_files":6,"success_rate":"25%"}}
{"infrastructure":{"postgres":"ready","redis":"ready","migrations":"5 applied","seed":"admin@fnd.dev created","backend":"started port 3099"}}
{"failed_files":["01-auth-signup-signin.hurl","02-auth-sessions.hurl","03-auth-password-reset.hurl","04-auth-email-verification.hurl","05-manager-users.hurl","06-manager-impersonate.hurl","07-manager-metrics.hurl"]}
{"passed_files":["00-setup.hurl"]}

---

## Erro Principal: Rate Limit Blocking Tests

**Arquivo:** `01-auth-signup-signin.hurl:65`
**Esperado:** HTTP 400
**Recebido:** HTTP 429 (Too Many Requests)

### Root Cause

O **rate limit guard** est√° bloqueando requisi√ß√µes de teste. O guard est√° sendo aplicado globalmente ou em endpoints espec√≠ficos e impedindo que m√∫ltiplas requisi√ß√µes sejam feitas em sequ√™ncia durante os testes E2E.

### Context for /fix

**Endpoint afetado:** `POST /api/v1/auth/signup`
**Guard:** `RateLimitGuard`
**Arquivo prov√°vel:** [apps/backend/src/api/guards/rate-limit.guard.ts](apps/backend/src/api/guards/rate-limit.guard.ts)
**Service relacionado:** [apps/backend/src/api/modules/auth/services/rate-limit.service.ts](apps/backend/src/api/modules/auth/services/rate-limit.service.ts)
**Controller:** [apps/backend/src/api/modules/auth/auth.controller.ts](apps/backend/src/api/modules/auth/auth.controller.ts)

### Response Details

```
error: Assert status code
   --> 01-auth-signup-signin.hurl:65:6
    |
    | POST {{API_URL}}/auth/signup
    | ...
 65 | HTTP 400
    |      ^^^ actual value is <429>
```

### Impacto em Cascata

Como o signup retorna 429, todos os testes subsequentes que dependem de autentica√ß√£o tamb√©m falharam:
- `02-auth-sessions.hurl` - Requer token de usu√°rio autenticado
- `03-auth-password-reset.hurl` - Requer usu√°rio existente
- `04-auth-email-verification.hurl` - Requer usu√°rio existente
- `05-manager-users.hurl` - Requer super admin autenticado
- `06-manager-impersonate.hurl` - Requer super admin autenticado
- `07-manager-metrics.hurl` - Requer super admin autenticado

---

## Solu√ß√µes Poss√≠veis

1. **Desabilitar rate limit em ambiente de teste:**
   - Verificar `NODE_ENV` no guard
   - Bypass se `NODE_ENV === 'test'`

2. **Configurar rate limit mais permissivo para testes:**
   - Vari√°vel de ambiente `RATE_LIMIT_TTL_TEST`
   - Aumentar TTL para 60+ segundos em testes

3. **Usar IP whitelist para testes:**
   - Adicionar `127.0.0.1` √† lista de IPs isentos
   - Configur√°vel via `RATE_LIMIT_WHITELIST`

4. **Delay entre requisi√ß√µes nos testes:**
   - Adicionar `sleep` entre requests no Hurl
   - N√£o recomendado (aumenta tempo de execu√ß√£o)

---

## Arquivos Passando

- [x] `00-setup.hurl` - Health check (~50ms)

---

## Arquivos Falhando

- [ ] `01-auth-signup-signin.hurl` - Signup bloqueado por rate limit
- [ ] `02-auth-sessions.hurl` - Sem token (depende de 01)
- [ ] `03-auth-password-reset.hurl` - Sem usu√°rio (depende de 01)
- [ ] `04-auth-email-verification.hurl` - Sem usu√°rio (depende de 01)
- [ ] `05-manager-users.hurl` - Sem token admin (depende de 01)
- [ ] `06-manager-impersonate.hurl` - Sem token admin (depende de 01)
- [ ] `07-manager-metrics.hurl` - Sem token admin (depende de 01)

---

## Logs Relevantes

### Backend Startup (Sucesso)
```
üöÄ Starting FND EasyFlow in API mode...
[NestFactory] Starting Nest application...
[InstanceLoader] PassportModule dependencies initialized +27ms
[InstanceLoader] AuthModule dependencies initialized +48ms
‚úÖ API Server running on port 3099
```

### Database Seed (Sucesso)
```
INSERT 0 1
INSERT 0 1
[OK] Super admin created: admin@fnd.dev
```

### Test Execution Output
```
Executed files:    8
Executed requests: 12 (35.4/s)
Succeeded files:   2 (25.0%)
Failed files:      6 (75.0%)
Duration:          339 ms
```

---

## Pr√≥ximos Passos

Execute `/fix` e informe:
- "Corrigir rate limit bloqueando testes E2E"
- Ou referencie este relat√≥rio: `test-results-20251220-004427.md`

O agente `/fix` analisar√° este documento e aplicar√° corre√ß√µes no c√≥digo de produ√ß√£o.
